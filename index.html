<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>QueridÃ´metro Divos BabilÃ´nicos v3</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        #tela-login { display: block; max-width: 400px; margin: 80px auto; text-align: center; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 2px solid #ff4500; }
        #tela-principal { display: none; }

        /* LISTA DE CARDS */
        .lista-participantes { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .card { border: 1px solid #e4e6eb; padding: 15px; border-radius: 12px; background: #fff; text-align: center; position: relative; transition: 0.3s; }
        .foto-perfil { width: 110px; height: 110px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; border: 5px solid #ccc; }
        
        /* BORDAS DINÃ‚MICAS */
        .odiado { border-color: #ff0000 !important; box-shadow: 0 0 15px rgba(255, 0, 0, 0.4); }
        .alvo-casa { border-color: #007bff !important; box-shadow: 0 0 15px rgba(0, 123, 255, 0.4); }
        .favorito { border-color: #ffc107 !important; box-shadow: 0 0 15px rgba(255, 193, 7, 0.4); }

        /* BOTÃ•ES DE VOTO RÃPIDO */
        .voto-rapido { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; }
        .btn-emoji { background: #f0f2f5; border: none; border-radius: 5px; cursor: pointer; font-size: 1.2em; padding: 5px; transition: 0.2s; }
        .btn-emoji:hover { background: #e4e6eb; transform: scale(1.2); }
        .btn-emoji:disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(1); }

        /* INTERFACE */
        .user-info { background: #1877f2; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .area-admin { display: none; margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 1px dashed #ccc; }
        
        button { padding: 10px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        .btn-voto { background-color: #ff4500; color: white; }
        
        .contadores { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; font-size: 0.75em; margin: 10px 0; color: #666; }

        /* MODAL */
        #modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center; }
        .modal-content { background:white; padding:30px; border-radius:15px; width:90%; max-width:600px; text-align:center; }
        .log-votos { text-align: left; max-height: 250px; overflow-y: auto; font-size: 0.9em; background: #eee; padding: 10px; border-radius: 5px; margin: 15px 0; }
    </style>
</head>
<body>

<div id="tela-login">
    <h1 style="color: #ff4500;">ğŸ‘ï¸ <br>Divos BabilÃ´nicos</h1>
    <select id="loginUsuario" style="width: 100%; padding: 10px; margin-bottom: 10px;"></select>
    <input type="password" id="loginSenha" placeholder="Senha (123)" style="width: 94%; padding: 10px;">
    <button onclick="fazerLogin()" style="width: 100%; margin-top: 20px;" class="btn-voto">ENTRAR</button>
</div>

<div id="tela-principal" class="container">
    <div class="user-info">
        <span>ğŸ‘¤ ConfessionÃ¡rio: <strong id="nomeLogado"></strong></span>
        <button onclick="logout()" style="background:#606770; color: white;">SAIR</button>
    </div>

    <div class="lista-participantes" id="painel"></div>

    <div id="area-admin" class="area-admin">
        <h3>ğŸ“Š Painel de Controle (Kiara)</h3>
        <button onclick="verLogs()" style="background:#17a2b8; color:white;">ğŸ‘ï¸ Ver Quem Votou em Quem</button>
        <button onclick="abrirResumoMensal()" style="background:#ffc107;">ğŸ“Š Ranking Mensal</button>
        <button onclick="limparTudo()" style="background:#dc3545; color:white;">âš ï¸ Resetar MÃªs</button>
    </div>
</div>

<div id="modal">
    <div class="modal-content">
        <h2 id="modal-titulo"></h2>
        <div id="modal-corpo"></div>
        <button onclick="fecharModal()" class="btn-voto" style="width:100%">VOLTAR</button>
    </div>
</div>

<script>
    const nomes = ["Kiara", "Siqueira", "Sofia", "Gabis", "Lari", "Samuel", "Melesque", "Pedro", "Vini", "Thomaz", "Adrian", "Gui", "JoÃ£o", "Ju", "Marco", "Marcos", "Nick", "Oscar", "Vitinho"];
    let usuarioLogado = null;

    let participantes = JSON.parse(localStorage.getItem('bbb_participantes')) || nomes.map(n => ({
        nome: n, reacoes: { coracao:0, cobra:0, vomito:0, planta:0, alvo:0, mala:0, biscoito:0, bomba:0 }
    }));

    // Array de logs para salvar quem votou em quem
    let logsVotos = JSON.parse(localStorage.getItem('bbb_logs')) || [];
    let votosHoje = JSON.parse(localStorage.getItem('bbb_votos_hoje')) || {};

    function inicializar() {
        const loginSel = document.getElementById('loginUsuario');
        nomes.sort().forEach(n => loginSel.add(new Option(n, n)));
        atualizarPainel();
    }

    function fazerLogin() {
        const u = document.getElementById('loginUsuario').value;
        if (document.getElementById('loginSenha').value === "123") {
            usuarioLogado = u;
            document.getElementById('nomeLogado').textContent = u;
            document.getElementById('tela-login').style.display = 'none';
            document.getElementById('tela-principal').style.display = 'block';
            if(u === "Kiara") document.getElementById('area-admin').style.display = 'block';
            atualizarPainel();
        } else { alert("Senha incorreta!"); }
    }

    function votarDireto(paraNome, emoji) {
        if (usuarioLogado === paraNome) return alert("NÃ£o pode votar em si mesmo!");
        const chave = `${usuarioLogado}-${paraNome}`;
        if (votosHoje[chave]) return alert("VocÃª jÃ¡ votou nesta pessoa hoje!");

        // Registra o voto
        const alvo = participantes.find(p => p.nome === paraNome);
        alvo.reacoes[emoji]++;
        votosHoje[chave] = true;
        
        // Salva nos logs para a Kiara ver
        logsVotos.push({ de: usuarioLogado, para: paraNome, emoji: emoji, data: new Date().toLocaleString() });

        localStorage.setItem('bbb_participantes', JSON.stringify(participantes));
        localStorage.setItem('bbb_votos_hoje', JSON.stringify(votosHoje));
        localStorage.setItem('bbb_logs', JSON.stringify(logsVotos));
        
        atualizarPainel();
    }

    function atualizarPainel() {
        const painel = document.getElementById('painel');
        painel.innerHTML = '';
        
        let maxOdiado = 0, maxAlvo = 0, maxFav = 0;
        let pOdiado = "", pAlvo = "", pFav = "";

        participantes.forEach(p => {
            let odiadoScore = p.reacoes.cobra + p.reacoes.vomito;
            if (odiadoScore > maxOdiado) { maxOdiado = odiadoScore; pOdiado = p.nome; }
            if (p.reacoes.alvo > maxAlvo) { maxAlvo = p.reacoes.alvo; pAlvo = p.nome; }
            if (p.reacoes.coracao > maxFav) { maxFav = p.reacoes.coracao; pFav = p.nome; }
        });

        participantes.forEach(p => {
            let classeBorda = "", badge = "";
            if (p.nome === pOdiado && maxOdiado > 0) { classeBorda = "odiado"; badge = '<span class="status-badge badge-red">Odiado</span>'; }
            else if (p.nome === pAlvo && maxAlvo > 0) { classeBorda = "alvo-casa"; badge = '<span class="status-badge badge-blue">Alvo</span>'; }
            else if (p.nome === pFav && maxFav > 0) { classeBorda = "favorito"; badge = '<span class="status-badge badge-gold">Favorito</span>'; }

            const nomeArquivo = p.nome.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const jaVotou = votosHoje[`${usuarioLogado}-${p.nome}`];

            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                ${badge}
                <img src="./fotos/${nomeArquivo}.jpeg" class="foto-perfil ${classeBorda}" onerror="this.src='./fotos/${nomeArquivo}.jpg'; this.onerror=function(){this.src='https://ui-avatars.com/api/?name=${p.nome}&background=random'}">
                <h3>${p.nome}</h3>
                <div class="contadores">
                    <span>â¤ï¸${p.reacoes.coracao}</span><span>ğŸ${p.reacoes.cobra}</span><span>ğŸ¤®${p.reacoes.vomito}</span><span>ğŸŒ±${p.reacoes.planta}</span>
                    <span>ğŸ¯${p.reacoes.alvo}</span><span>ğŸ’¼${p.reacoes.mala}</span><span>ğŸª${p.reacoes.biscoito}</span><span>ğŸ’£${p.reacoes.bomba}</span>
                </div>
                <div class="voto-rapido">
                    <button class="btn-emoji" onclick="votarDireto('${p.nome}', 'coracao')" ${jaVotou ? 'disabled' : ''}>â¤ï¸</button>
                    <button class="btn-emoji" onclick="votarDireto('${p.nome}', 'cobra')" ${jaVotou ? 'disabled' : ''}>ğŸ</button>
                    <button class="btn-emoji" onclick="votarDireto('${p.nome}', 'vomito')" ${jaVotou ? 'disabled' : ''}>ğŸ¤®</button>
                    <button class="btn-emoji" onclick="votarDireto('${p.nome}', 'planta')" ${jaVotou ? 'disabled' : ''}>ğŸŒ±</button>
                    <button class="btn-emoji" onclick="votarDireto('${p.nome}', 'alvo')" ${jaVotou ? 'disabled' : ''}>ğŸ¯</button>
                    <button class="btn-emoji" onclick="votarDireto('${p.nome}', 'mala')" ${jaVotou ? 'disabled' : ''}>ğŸ’¼</button>
                    <button class="btn-emoji" onclick="votarDireto('${p.nome}', 'biscoito')" ${jaVotou ? 'disabled' : ''}>ğŸª</button>
                    <button class="btn-emoji" onclick="votarDireto('${p.nome}', 'bomba')" ${jaVotou ? 'disabled' : ''}>ğŸ’£</button>
                </div>`;
            painel.appendChild(card);
        });
    }

    function verLogs() {
        document.getElementById('modal-titulo').textContent = "ğŸ“œ HistÃ³rico de Votos";
        let html = "<div class='log-votos'>";
        logsVotos.slice().reverse().forEach(l => {
            const emojis = {coracao:'â¤ï¸', cobra:'ğŸ', vomito:'ğŸ¤®', planta:'ğŸŒ±', alvo:'ğŸ¯', mala:'ğŸ’¼', biscoito:'ğŸª', bomba:'ğŸ’£'};
            html += `â€¢ <strong>${l.de}</strong> deu ${emojis[l.emoji]} para <strong>${l.para}</strong> <small>(${l.data})</small><br>`;
        });
        document.getElementById('modal-corpo').innerHTML = html + "</div>";
        document.getElementById('modal').style.display = 'flex';
    }

    function abrirResumoMensal() {
        document.getElementById('modal-titulo').textContent = "ğŸ“Š Ranking Geral";
        let html = "<ul>";
        participantes.sort((a,b) => b.reacoes.coracao - a.reacoes.coracao).forEach(p => {
            html += `<li><strong>${p.nome}</strong>: â¤ï¸${p.reacoes.coracao} | ğŸ${p.reacoes.cobra} | ğŸ¯${p.reacoes.alvo}</li>`;
        });
        document.getElementById('modal-corpo').innerHTML = html + "</ul>";
        document.getElementById('modal').style.display = 'flex';
    }

    function fecharModal() { document.getElementById('modal').style.display = 'none'; }
    function limparTudo() { if(confirm("Deseja zerar tudo?")) { localStorage.clear(); location.reload(); } }
    function logout() { location.reload(); }
    window.onload = inicializar;
</script>
</body>
</html>
