<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>QueridÃ´metro Divos BabilÃ´nicos</title>
    <style>
        /* CSS: Identidade Visual e Layout */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        /* TELAS */
        #tela-login { display: block; max-width: 450px; margin: 80px auto; text-align: center; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 2px solid #ff4500; }
        #tela-principal { display: none; }

        /* CARDS E BORDAS */
        .lista-participantes { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .card { border: 1px solid #e4e6eb; padding: 15px; border-radius: 12px; background: #fff; text-align: center; position: relative; transition: 0.3s; }
        .foto-perfil { width: 110px; height: 110px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; border: 5px solid #ccc; transition: 0.3s; }
        
        .odiado { border-color: #ff0000 !important; box-shadow: 0 0 15px rgba(255, 0, 0, 0.4); }
        .alvo-casa { border-color: #007bff !important; box-shadow: 0 0 15px rgba(0, 123, 255, 0.4); }
        .favorito { border-color: #ffc107 !important; box-shadow: 0 0 15px rgba(255, 193, 7, 0.4); }

        .status-badge { position: absolute; top: 10px; right: 10px; font-size: 0.7em; font-weight: bold; text-transform: uppercase; padding: 3px 8px; border-radius: 20px; color: white; z-index: 10; }
        .badge-red { background: #ff0000; }
        .badge-blue { background: #007bff; }
        .badge-gold { background: #ffc107; color: black; }

        /* INTERFACE */
        .controles { background: #fff1eb; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #ffd8c7; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: center; }
        .user-info { background: #1877f2; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        
        button { padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-voto { background-color: #ff4500; color: white; }
        .btn-admin { margin-top: 30px; padding-top: 20px; border-top: 2px dashed #eee; display: none; gap: 10px; justify-content: center; }

        .contadores { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; font-size: 0.85em; background: #f9f9f9; padding: 10px; border-radius: 8px; }

        /* MODAL */
        #modal-mensal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center; }
        #modal-mensal.ativo { display: flex; }
        .modal-content { background: white; width: 90%; max-width: 550px; padding: 30px; border-radius: 15px; text-align: center; position: relative; }
    </style>
</head>
<body>

<div id="tela-login">
    <h1>ğŸ‘ï¸ <br>Divos BabilÃ´nicos</h1>
    <p>Bem-vindo ao confessionÃ¡rio!</p>
    <select id="loginUsuario" style="width: 100%; padding: 10px; margin-bottom: 10px;"></select>
    <input type="password" id="loginSenha" placeholder="Senha (padrÃ£o: 123)" style="width: 94%; padding: 10px;">
    <button onclick="fazerLogin()" style="width: 100%; margin-top: 20px;" class="btn-voto">ENTRAR</button>
</div>

<div id="tela-principal" class="container">
    <div class="user-info">
        <span>ğŸ‘¤ Bem-vinda ao confessionÃ¡rio, <strong id="nomeLogado"></strong>!</span>
        <button onclick="logout()" style="background:#606770;">SAIR</button>
    </div>

    <div class="controles">
        <strong>Votar em:</strong>
        <select id="selectPara" style="padding: 10px;"></select>
        <strong>Emoji:</strong>
        <select id="selectEmoji" style="padding: 10px;">
            <option value="coracao">â¤ï¸ CoraÃ§Ã£o</option>
            <option value="cobra">ğŸ Cobra</option>
            <option value="vomito">ğŸ¤® VÃ´mito</option>
            <option value="planta">ğŸŒ± Planta</option>
            <option value="alvo">ğŸ¯ Alvo</option>
            <option value="mala">ğŸ’¼ Mala</option>
            <option value="biscoito">ğŸª Biscoito</option>
            <option value="bomba">ğŸ’£ Bomba</option>
        </select>
        <button onclick="darEmoji()" class="btn-voto">REGISTRAR VOTO</button>
    </div>

    <div class="lista-participantes" id="painel"></div>

    <div id="area-admin" class="btn-admin">
        <button onclick="abrirResumoMensal()" style="background:#17a2b8; color:white;">ğŸ“Š EstatÃ­sticas Completas</button>
        <button onclick="limparTudo()" style="background:#dc3545; color:white;">âš ï¸ Resetar Todo o MÃªs</button>
    </div>
</div>

<div id="modal-mensal">
    <div class="modal-content">
        <h2>Ranking BabilÃ´nico Mensal</h2>
        <div id="dados-mensais" style="text-align: left; max-height: 400px; overflow-y: auto; margin: 20px 0;"></div>
        <button onclick="fecharModal()" class="btn-voto" style="width:100%">FECHAR</button>
    </div>
</div>

<script>
    /* LÃ“GICA DO SISTEMA */
    const nomes = ["Kiara", "Siqueira", "Sofia", "Gabis", "Lari", "Samuel", "Melesque", "Pedro", "Vini", "Thomaz", "Adrian", "Gui", "JoÃ£o", "Ju", "Marco", "Marcos", "Nick", "Oscar", "Vitinho"];
    let usuarioLogado = null;

    let participantes = JSON.parse(localStorage.getItem('bbb_participantes')) || nomes.map(n => ({
        nome: n,
        reacoes: { coracao: 0, cobra: 0, vomito: 0, planta: 0, alvo: 0, mala: 0, biscoito: 0, bomba: 0 }
    }));

    let votosRealizados = JSON.parse(localStorage.getItem('bbb_votos')) || {};

    function inicializar() {
        const loginSel = document.getElementById('loginUsuario');
        const selectPara = document.getElementById('selectPara');
        nomes.sort().forEach(n => {
            loginSel.add(new Option(n, n));
            selectPara.add(new Option(n, n));
        });
        atualizarPainel();
    }

    function fazerLogin() {
        const u = document.getElementById('loginUsuario').value;
        const s = document.getElementById('loginSenha').value;
        if (s === "123") {
            usuarioLogado = u;
            document.getElementById('nomeLogado').textContent = u;
            document.getElementById('tela-login').style.display = 'none';
            document.getElementById('tela-principal').style.display = 'block';
            // Trava de seguranÃ§a para a Kiara
            if(u === "Kiara") document.getElementById('area-admin').style.display = 'flex';
        } else { alert("Senha incorreta!"); }
    }

    function darEmoji() {
        const para = document.getElementById('selectPara').value;
        const emoji = document.getElementById('selectEmoji').value;
        if (usuarioLogado === para) { alert("NÃ£o pode votar em si mesmo!"); return; }
        const chave = `${usuarioLogado}-${para}`;
        if (votosRealizados[chave]) { alert("VocÃª jÃ¡ votou nesta pessoa hoje!"); return; }

        const alvo = participantes.find(p => p.nome === para);
        alvo.reacoes[emoji]++;
        votosRealizados[chave] = true;
        salvar();
        atualizarPainel();
    }

    function atualizarPainel() {
        const painel = document.getElementById('painel');
        painel.innerHTML = '';

        let maxOdiado = 0, maxAlvo = 0, maxFav = 0;
        let pOdiado = "", pAlvo = "", pFav = "";

        participantes.forEach(p => {
            let odiadoScore = p.reacoes.cobra + p.reacoes.vomito;
            if (odiadoScore > maxOdiado) { maxOdiado = odiadoScore; pOdiado = p.nome; }
            if (p.reacoes.alvo > maxAlvo) { maxAlvo = p.reacoes.alvo; pAlvo = p.nome; }
            if (p.reacoes.coracao > maxFav) { maxFav = p.reacoes.coracao; pFav = p.nome; }
        });

        participantes.forEach(p => {
            let classeBorda = "", badge = "";
            if (p.nome === pOdiado && maxOdiado > 0) { classeBorda = "odiado"; badge = '<span class="status-badge badge-red">Odiado</span>'; }
            else if (p.nome === pAlvo && maxAlvo > 0) { classeBorda = "alvo-casa"; badge = '<span class="status-badge badge-blue">Alvo</span>'; }
            else if (p.nome === pFav && maxFav > 0) { classeBorda = "favorito"; badge = '<span class="status-badge badge-gold">Favorito</span>'; }

            // LÃ³gica robusta para fotos (sem acentos e tenta .jpg/.png)
            const nomeBase = p.nome.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s/g, "");
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                ${badge}
                <img src="fotos/${nomeBase}.jpg" class="foto-perfil ${classeBorda}" 
                     onerror="this.onerror=function(){this.onerror=function(){this.src='https://ui-avatars.com/api/?name=${p.nome}&background=random'}; this.src='fotos/${nomeBase}.png'}; this.src='fotos/${nomeBase}.jpeg'">
                <h3>${p.nome}</h3>
                <div class="contadores">
                    <span>â¤ï¸ ${p.reacoes.coracao}</span><span>ğŸ ${p.reacoes.cobra}</span><span>ğŸ¤® ${p.reacoes.vomito}</span>
                    <span>ğŸŒ± ${p.reacoes.planta}</span><span>ğŸ¯ ${p.reacoes.alvo}</span><span>ğŸ’¼ ${p.reacoes.mala}</span>
                    <span>ğŸª ${p.reacoes.biscoito}</span><span>ğŸ’£ ${p.reacoes.bomba}</span>
                </div>`;
            painel.appendChild(card);
        });
    }

    function abrirResumoMensal() {
        const dados = document.getElementById('dados-mensais');
        let ranking = [...participantes].sort((a,b) => b.reacoes.coracao - a.reacoes.coracao);
        let html = "<ul style='list-style:none; padding:0;'>";
        ranking.forEach(p => {
            html += `<li style="padding:10px; border-bottom:1px solid #eee;">
                <strong>${p.nome}</strong><br>
                <div style="display:grid; grid-template-columns: repeat(4, 1fr); font-size:0.8em; margin-top:5px;">
                    <span>â¤ï¸ ${p.reacoes.coracao}</span><span>ğŸ ${p.reacoes.cobra}</span><span>ğŸ¤® ${p.reacoes.vomito}</span><span>ğŸŒ± ${p.reacoes.planta}</span>
                    <span>ğŸ¯ ${p.reacoes.alvo}</span><span>ğŸ’¼ ${p.reacoes.mala}</span><span>ğŸª ${p.reacoes.biscoito}</span><span>ğŸ’£ ${p.reacoes.bomba}</span>
                </div></li>`;
        });
        dados.innerHTML = html + "</ul>";
        document.getElementById('modal-mensal').classList.add('ativo');
    }

    function fecharModal() { document.getElementById('modal-mensal').classList.remove('ativo'); }
    function salvar() { localStorage.setItem('bbb_participantes', JSON.stringify(participantes)); localStorage.setItem('bbb_votos', JSON.stringify(votosRealizados)); }
    function limparTudo() { if(confirm("Zerar tudo?")) { localStorage.clear(); location.reload(); } }
    function logout() { location.reload(); }
    window.onload = inicializar;
</script>
</body>
</html>